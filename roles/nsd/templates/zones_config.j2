# NSD configuration, automatically generated by Ansible.
# Do not edit by hand!

{% for key in nsd_tsig_keys|default([]) %}
key:
    name: "{{ key.tsig_keyname }}"
    secret: "{{ key.tsig_secret }}"
    algorithm: "{{ key.tsig_algorithm }}"
{% endfor %}

{% for zone in nsd_unsigned_zones %}
zone:
  name: "{{ zone.zone_name }}"
  zonefile: "{{ nsd_master_zones_dir }}/{{ zone.zone_name }}"
{% if is_nsd_master|default(false) %}
{% for slave in zone.slaves|default([]) %}
  notify: {{ slave.ip }} "{{ slave.tsig_key|default('NOKEY') }}"
  provide-xfr: {{ slave.ip }} "{{ slave.tsig_key|default('NOKEY') }}"
{% endfor %}
{% else %}
{% for master in zone.masters|default([]) %}
  allow-notify: {{ master.ip }} "{{ master.tsig_key|default('NOKEY') }}"
  request-xfr: AXFR {{ master.ip }} "{{ master.tsig_key|default('NOKEY') }}"
{% endfor %}
{% endif %}
{% endfor %}

{% for zone in nsd_signed_zones %}
zone:
  name: "{{ zone.zone_name }}"
  zonefile: "{{ nsd_master_zones_dir }}/{{ zone.zone_name }}"
{% if is_nsd_master|default(false) %}
{% for slave in zone.slaves|default([]) %}
  notify: {{ slave.ip }} "{{ slave.tsig_key|default('NOKEY') }}"
  provide-xfr: {{ slave.ip }} "{{ slave.tsig_key|default('NOKEY') }}"
{% endfor %}
{% else %}
{% for master in zone.masters|default([]) %}
  allow-notify: {{ master.ip }} "{{ master.tsig_key|default('NOKEY') }}"
  request-xfr: AXFR {{ master.ip }} "{{ master.tsig_key|default('NOKEY') }}"
{% endfor %}
{% endif %}
{% endfor %}

# Explicit to ns-master.g.o as that is where ACLs for various
# abisource* domains point to.
{% if ansible_fqdn == 'nsd01.gnome.org' %}
{% for zone in abisource_zones %}
zone:
  name: "{{ zone.zone_name }}"
  zonefile: "{{ nsd_master_zones_dir }}/{{ zone.zone_name }}"
{% for master in zone.masters|default([]) %}
  allow-notify: {{ master.ip }} "{{ master.tsig_key|default('NOKEY') }}"
  request-xfr: AXFR {{ master.ip }} "{{ master.tsig_key|default('NOKEY') }}"
{% endfor %}
{% endfor %}
{% endif %}
